<ng-template #rt let-listEntry="result">
  <ul class="list-unstyled mb-0">
    @if (listEntry.display) {
    <li
      class="list-item text-truncate text-primary"
      [innerHtml]="listEntry.display">
    </li>
    } @else {
    <li class="list-item text-truncate text-primary fw-bold">
      {{listEntry.value}}
    </li>
    }

    @if (listEntry.hasOtherInformation()) {
    @for (item of listEntry.otherInformation | dsObjNgFor; track item.key) {

    <li class="list-item text-truncate text-secondary" >
      {{ 'form.other-information.' + item.key | translate }} : {{item.value}}
    </li>

    }}
  </ul>
</ng-template>

<div class="position-relative right-addon">

  @if ((vocabulary$ | async)?.hierarchical) {

  <i class="dropdown-toggle position-absolute tree-toggle" (click)="openTree($event)"
    aria-hidden="true"></i>
  <input class="form-control"
    [attr.aria-labelledby]="'label_' + model.id"
    [attr.autoComplete]="model.autoComplete"
    [attr.aria-label]="model.label | translate"
    [class.is-invalid]="showErrorMessages"
    [class.tree-input]="!model.readOnly"
    [id]="id"
    [name]="model.name"
    [placeholder]="model.placeholder"
    [readonly]="true"
    [disabled]="model.readOnly"
    [type]="model.inputType"
    [value]="currentValue?.display"
    (focus)="onFocus($event)"
    (change)="onChange($event)"
    (click)="openTree($event)"
    (keydown)="$event.preventDefault()"
    (keypress)="$event.preventDefault()"
    (keyup)="$event.preventDefault()">

  } @else {

  @if (loading) {
  <i
    class="fas fa-circle-notch fa-spin fa-2x fa-fw text-primary position-absolute mt-1 p-0"
    aria-hidden="true">
  </i>
  } @else {
  <i
    dsAuthorityConfidenceState
    class="far fa-circle fa-2x fa-fw position-absolute mt-1 p-0"
    aria-hidden="true"
    [authorityValue]="currentValue"
    (whenClickOnConfidenceNotAccepted)="whenClickOnConfidenceNotAccepted($event)">
  </i>
  }

  <input #typeahead="ngbTypeahead"
    class="form-control"
    [attr.aria-labelledby]="'label_' + model.id"
    [attr.autoComplete]="model.autoComplete"
    [attr.aria-label]="model.label | translate"
    [class.is-invalid]="showErrorMessages"
    [id]="model.id"
    [name]="model.name"
    [ngbTypeahead]="search"
    [placeholder]="model.placeholder"
    [readonly]="model.readOnly"
    [disabled]="model.readOnly"
    [resultTemplate]="rt"
    [type]="model.inputType"
    [(ngModel)]="currentValue"
    (blur)="onBlur($event)"
    (focus)="onFocus($event)"
    (change)="onChange($event)"
    (input)="onInput($event)"
    (selectItem)="onSelectItem($event)">

  @if (searchFailed) {
  <div class="invalid-feedback">Sorry, suggestions could not be loaded.</div>
  }

  }
</div>
